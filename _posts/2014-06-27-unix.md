---
layout: post
title: "Unix"
tags: unix
permalink: unix
---

### Helper

```sh
$ ~ $ home user directory  
$ ~+ # same as pwd  
$ ~- # previous directory  
$ ls -1 $PWD/*.txt # list all .txt with full path  
$ cd - # cd to previous path
$ export EDITOR=vim # set vim as default editor
$ groups #list group
$ getent group <group_name> #list members of group
$ top #check performance
$ du -sh <folder> # summary disk usage of folder
$ df -h # disk free
$ chsh - <user> # change default ssh user
$ printenv # list environment variables
```


### Command

```sh
nl #number line
xargs <cmd> #change input to arguments, use with pipe
sed #stream editor
pbcopy < <file> # copy file into clipboard
```

### Where command

```sh
$ hash # list command and its path  
$ type -a <cmd> # tell all path of commamd  
$ which <cmd> # tell default path of command  
```

### [Redirection](http://en.wikipedia.org/wiki/Redirection_computing)

```sh
$ cmd > <file> # print output to file (overwrite)  
$ cmd >> <file> # print output to file (append)  
$ cmd 2> <file> # print error to file  
$ cmd &> <file> # print output & error to file  
$ cmd < <file> # use file as  input  
$ cmd << <file> # use file as input  
# Redirection output wiht sudo
$ echo "hello" | sudo tee out > /dev/null # eq. echo "hello" > out
# echo "hello" | sudo tee -a out > /dev/null # eq echo "hello" > out
```

### Jobs

```sh
$ jobs # list active jobs  
$ fg # put the current in the foreground  
Ctrl-z # Suspend a foreground job
```

### Crontab Time schedule

```sh
$ crontab -e #edit crontab profile
# */5 * * * * cmd
# run cmd every five minutes
$ grep CRON /var/log/syslog #see crontablog (debian)
```

### Sed - Stream Editor
1. [The Basics of Using the Sed Stream Editor to Manipulate Text in Linux](https://www.digitalocean.com/community/tutorials/the-basics-of-using-the-sed-stream-editor-to-manipulate-text-in-linux)
2. [Intermediate Sed: Manipulating Streams of Text in a Linux Environment](https://www.digitalocean.com/community/articles/intermediate-sed-manipulating-streams-of-text-in-a-linux-environment)
3. [Unix - Regular Expressions with SED](http://www.tutorialspoint.com/unix/unix-regular-expressions.htm)
4. [Unix Sed Tutorial: Append, Insert, Replace, and Count File Lines](http://www.thegeekstuff.com/2009/11/unix-sed-tutorial-append-insert-replace-and-count-file-lines/)
5. [Add Character to the Beginning or to the End of Each Line using AWK and SED](http://www.shellhacks.com/en/Add-Character-to-the-Beginning-or-to-the-End-of-Each-Line-using-AWK-and-SED)
6. [sed, a stream editor](https://www.gnu.org/software/sed/manual/sed.html)
7. [Sed & Awk Book](http://docstore.mik.ua/orelly/unix/sedawk/index.htm)


### Shell/Bash Script

```sh
#!/bin/bash

VAR = "hello"
if [ "$VAR" = "hello" ]; then  # use = to equal string not ==
  echo $VAR
else
  echo "fasle"
fi
```


#### [Bash For Loop Array: Iterate Through Array Values](http://www.cyberciti.biz/faq/bash-for-loop-array/)
1. [Introduction to if](http://www.tldp.org/LDP/Bash-Beginners-Guide/html/sect_07_01.html)

```sh
if [ $? -eq 0 ]
do
	echo "hello"
done
```

2. [Linux seq command format option example](http://www.unixcl.com/2009/09/linux-seq-command-format-option-example.html)

```sh
#!/bin/bash

array=( one two three )

for i in "${array[@]}"
do
	echo $i
done
```

### Zsh History expansion 
should also work with bash.

```sh
$ man zshexpn # manual for look in-depth  
$ history # tell history command that keep in ~/.bash_history  
$ history -c # clear history  
! # previous that can combine with command and argument  
$ !! # call previous command  
$ !<str> # call last command that start with str  
$ !?<str>[?] # call last command containing str  
$ !<hist_number> # call command in nth of history files  
 ^ # first argument  
 $ # last argument  
 <n> # nth argument  
 * # all argument  
$ <space><cmd> # call command without keep history
```

### Zsh Basic Editing
should also work with bash.

```sh
$ bindkey -v # vi mode  
$ bindkey -e # emac mode  
Ctrl + a # moves the cursor to begin of line  
Ctrl + e # moves the cursor to end of line  
Ctrl + u # delete current to begin of line
Ctrl + k # delete until end of line  
Ctrl + l # clear
Ctrl + w # delete word backwords  
Ctrl + d # delete char (moves forward)  
Meta + f # move word foreward
Meata + b # move word backward
Ctrl + y # yank last delete word  
Ctrl + t # transpoes two characters  
Esc + t # transpoes two words  

Meta is your Alt key, normally.
For Mac OSX user need to enable it,  Open Terminal > Preferences > Settings > Keyboard, and enable Use option as meta key.
```

### Run Script - [Different ways to execute a shell script](http://unix.stackexchange.com/questions/2976/different-ways-to-execute-a-shell-script)

```sh
$ ./script      #run with using shebang(#) in script ex. #!/usr/bin/python
$ . script      #run with shell (work in related bash)
$ source script #run with shell (work in both bash and csh)
```

### [Diff Command](http://linux.about.com/library/cmd/blcmdl1_diff.htm)

```sh
$ diff --brief <file1> <file2>
```


### Shell function - [Passing argument to alias in bash](http://stackoverflow.com/questions/4060880/passing-argument-to-alias-in-bash)

```sh
$ echo 'rm() { mkdir -p /tmp/rm; /bin/mv "$@" /tmp/rm; }' >> .zshrc
```

### [Execute combine multiple linux commands in one line](http://stackoverflow.com/questions/13077241/execute-combine-multiple-linux-commands-in-one-line)

```sh
cmd1 && cmd2  # cmd 2 run only if cmd1 successful
cmd1 ; cmd2  # cmd 2 run whether failed or not
```

###  Parallel shell script
1. [Parallel batch processing in the shell](http://prll.sourceforge.net/shell_parallel.html)  
2. [Bash script processing commands in parallel](http://stackoverflow.com/questions/19543139/bash-script-processing-commands-in-parallel)  

```sh
process1 &
process2 &
process3 &
process4 &
wait  # wait until process1, 2, 3, 4 done
process5 &
process6 &
process7 &
process8 &
wait  # wait until process5, 6, 7, 8 done
```

3. [Parallelize Bash Script](http://stackoverflow.com/questions/38160/parallelize-bash-script)

```sh
#!/bin/bash

nproc=$(($(nproc)-1))  # number of core cpu - 1

# waitproc - wait until have core slots
waitproc () {
  jobcnt=($(jobs -p))
  until [ ${#jobcnt[@]} -lt $nproc ]; do
    sleep 0.05
    jobcnt=($(job -p))
  done
```

## Reference
1. [learning the shell](http://www.linuxcommand.org/lc3_learning_the_shell.php)
2. [HowTo: Add Jobs To cron Under Linux or UNIX?](http://www.cyberciti.biz/faq/how-do-i-add-jobs-to-cron-under-linux-or-unix-oses/)
3. [how to set cron job to run every 5 mins?](http://www.linuxquestions.org/questions/linux-general-1/how-to-set-cron-job-to-run-every-5-mins-61667/)
4. [CronHowto](https://help.ubuntu.com/community/CronHowto)
5. [Checking UNIX Server Performance](http://www.sitepoint.com/unix-server-performance/)
6. [How do I use sudo to redirect output to a location I don't have permission to write to?](http://stackoverflow.com/questions/82256/how-do-i-use-sudo-to-redirect-output-to-a-location-i-dont-have-permission-to-wr)
7. [UNIX Disk Usage Command Examples](http://www.cyberciti.biz/faq/unix-disk-usage-command-examples/)
