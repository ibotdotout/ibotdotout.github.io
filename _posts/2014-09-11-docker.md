---
layout: post
title: Docker.io
tags: docker
permalink: docker
update_date: 2016-02-15
---

## Docker Support Only 64-bit System

> docker-engine not docker.io anymore  
> docker.io is old name

### [Docker try it! - Interactive Tutorial](https://www.docker.com/tryit/)

### Install

#### [Install on Debian](https://docs.docker.com/engine/installation/debian/#debian-wheezy-stable-7-x-64-bit)

```sh
# Debian Jessie 8.0 (64-bit) or unstable packages
$ sudo apt-get update
$ sudo apt-get install docker-engine
```
- [Package 'docker.io' has no installation candidate - Debian
Jessie](http://linuxconfig.org/package-docker-io-has-no-installation-candidate-debian-jessie)


#### [Install on OSX](http://docs.docker.com/installation/mac/) - [Homebrew-Cask](http://caskroom.io)

```sh
# if virtualbox not installed, install via homebrew cask
http://docs.docker.com/installation/mac/#from-your-shell

$ brew install caskroom/cask/brew-cask
$ brew cask install dockertoolbox

# start docker engine
$ docker-machine create
$ eval "$(docker-machine env default)"
```

### [Run Docker without sudo](https://docs.docker.com/installation/debian/#giving-non-root-access)

```sh
#debian
$ sudo groupadd docker
$ sudo gpasswd -a ${USER} docker # or sudo adduser ${USER} docker
$ sudo service docker restart
```

### Command Tips:

```sh
$ docker images --tree #list images in tree structure ('--tree' is deprecated)
$ docker ps -a #List all containers
$ docker ps -l #List lastest containers
$ docker ps -q #List containers display on IDs (quiet)
```

### Command by yourself in containers - [Working with Containers](https://docs.docker.com/userguide/usingdocker/)

```sh
$ docker run -i -t <image> /bin/bash
```

### [How to continue a docker which is exited](http://stackoverflow.com/questions/21928691/how-to-continue-a-docker-which-is-exited)

```sh
docker start `docker ps -q -l` # restart it in the background
docker attach `docker ps -q -l` # reattach the terminal & stdin
```

### [Clean Up - Remove Docker after exited](https://docs.docker.com/reference/run/#clean-up-rm)

```sh
$ docker run --rm <imamge>
```

### [Docker: remove all Exited containers by Filippo Valsorda](https://coderwall.com/p/zguz_w)

```sh
$ sudo docker ps -a | grep Exit | cut -d ' ' -f 1 | xargs sudo docker rm
```

### Remove < none > images

```sh
# if space full in docker engine
$ docker rmi $(docker images | grep '<none>' | tr -s ' ' | cut -d ' ' -f 3)
# or
$ docker images -a | grep none | awk '{print $3}' | xargs docker rmi -f
```

### Fix Repositoryalready being pulled
```sh
# $ dokcer pull <images>
# Fix Repository debian already being pulled by another client. Waiting.
$ sudo service docker restart
```

### Mount directory to container - [Managing data in containers](https://docs.docker.com/userguide/dockervolumes/)

```sh
# docker run option
# -v, --volume=[] create a volume
# -v host:container mount host directory to container
#   ex. -v $PWD:/app , mount current path to /app in container
# -w, --workdir="" Working directory inside the container

$ docker run -v <host_dir_path>:<container_dir_path> -w <workdir_path> <image> <cmd>
```

### Docker daemon on Debian: not start automatically - [Bash Scripting: Wait for wireless connection, execute program](https://bbs.archlinux.org/viewtopic.php?id=51939)

1. write this script and add it into crontab ($ sudo crontab -e)

```sh
#!/bin/bash

Q="0"
while [ $Q = "0" ]; do
   Q=$(ping -c1 www.google.com 2> /dev/null | grep -c google);
done
echo Connected!

sudo service docker restart
```

### Run multiple command in docker

```sh
$ docker exec <image> sh -c ‘<cmd>’
$ docker run <image> bash -c ‘<cmd>’
```

### [Crontab in Docker](http://www.ekito.fr/people/run-a-cron-job-with-docker/)

#### [Crontab with Docker enviorment](https://registry.hub.docker.com/u/draffensperger/postgres-s3-backup/dockerfile/) - [Sample Project](https://github.com/draffensperger/postgres-s3-backup)

Dockerfile

```sh
# Docker env don't pass though cron jobs, you need to save env to file and load it in cron jobs.
# save Docker envoirment to file with command "env > <file>"

# To debug crontab see to run "rsyslogd" and see logs at "/var/log/syslo"
# CMD rsyslogd && && env > /root/env.sh && tail -f /var/log/cron.log

CMD cron && env > /root/env.sh && tail -f /var/log/cron.log
```

cron_task.sh

```sh
env - `cat /root/env.sh` $1
```

crontab

```sh
# always need ot >> to some where to avoid “(CRON) info (No MTA installed, discarding output)” error in the syslog
# http://askubuntu.com/questions/222512/cron-info-no-mta-installed-discarding-output-error-in-the-syslog

* * * * * root crontab_task.sh “<your command>" >> /var/log/cron.log 2>&1
#An empty line is required at the end of this file for a valid cron file.
```

### docker Error: client and server don't have same version

```sh
$ docker-machine upgrade <machine>
```

### [Set time zone in Dockerfile](http://tedwise.com/2015/05/02/setting-the-timezone-in-a-docker-image)

```sh
$ echo "Asia/Bangkok" > /etc/timezone && dpkg-reconfigure -f noninteractive tzdata
```

### Push docker to registry

```sh
$ docker login
# docker tag <image> <username/image:version>
$ docker tag viau10-app ibotdotout/viau10-app:latest
# docker push <username/image>
$ docker push ibotdotout/viau10-app

# private registry
$ docker tag <contrainer_id> <your_registry_domain>/<image>
$ docker push <your_registry_domain>/<image>
```

### [Force clean build of an image (without cache)](https://github.com/docker/docker/issues/1326)

```sh
$ docker build --no-cache .
```

### [graphdriver prior storage driver "aufs" failed: invalid argument ](https://github.com/docker/docker/issues/14026) by @Kelindar 

```sh
$ sudo rm -rf /var/lib/docker/aufs
```

### Install Docker-compose aka Fig

``sh
$ apt-get update && apt-get upgrade -y
$ apt-get install -y python-pip
$ pip install -U docker-compose
```

### Docker-Compose Production

```sh
# https://docs.docker.com/compose/extends/
$ docker-compose -f production.yml
```

### Dockerfile
1. [Dockerfile Reference](https://docs.docker.com/reference/builder/)
2. [Docker Explained: Using Dockerfiles to Automate Building of Images](https://www.digitalocean.com/community/tutorials/docker-explained-using-dockerfiles-to-automate-building-of-images)
3. [Dockerfile Best Practices](http://crosbymichael.com/dockerfile-best-practices.html)
31. [Best practices for building secure Docker images](https://www.youtube.com/watch?v=LmUw2H6JgJo)
30. [Putting data in a volume in a Dockerfile](http://jpetazzo.github.io/2015/01/19/dockerfile-and-data-in-volumes/)
26. [Refactoring a Dockerfile for image size](http://blog.replicated.com/2016/02/05/refactoring-a-dockerfile-for-image-size/)

  ```sh
  $ apt-get install -y --no-install-recommends <packages>
  ```


### TDD for Dockerfile - [ServerSpec](http://serverspec.org)
1. [TDD for Dockerfile by RSpec (severspec)](https://coderwall.com/p/5xylsg/tdd-for-dockerfile-by-rspec-severspec)


### Dokcer Helper Tools::
1. [kitematic- Docker on Mac](https://kitematic.com/)
2. [Dockviz - Visualizing Docker Data](https://github.com/justone/dockviz)
4. [Vim Syntax for  Dockerfile](https://github.com/ekalinin/Dockerfile.vim)
6. [Squash docker images to make them smaller.](https://github.com/jwilder/docker-squash)


### Reference::
1. [Docker User Guide](https://docs.docker.com/userguide/)
2. [Docker Benefits](http://knitatoms.net/2013/12/benefits-of-docker-for-application-deployment/)
1. [How to Manage your Docker Image](https://developer.basespace.illumina.com/docs/content/documentation/native-apps/manage-docker-image)
3. [15 QUICK DOCKER TIPS](http://www.centurylinklabs.com/15-quick-docker-tips/)
4. [Guidance for Docker Image Authors](http://www.projectatomic.io/docs/docker-image-author-guidance/)
5. [How We Run as a Non-Root Inside Docker Container](http://www.yegor256.com/2014/08/29/docker-non-root.html)
6. [Docker Command Line Doc](http://docs.docker.com/reference/commandline/cli/)
7. [MAKING DOCKER IMAGES SMALLER](http://www.centurylinklabs.com/optimizing-docker-images/?hvid=2b3AmY)
8. [DOCKER DESKTOP](http://blog.docker.com/2013/07/docker-desktop-your-desktop-over-ssh-running-inside-of-a-docker-container/) - [Github](https://github.com/rogaha/docker-desktop)
9. [jenkins-docker-executors](https://registry.hub.docker.com/u/michaelneale/jenkins-docker-executors/dockerfile/)
11. [Clean up after Docker](http://blog.stefanxo.com/2014/02/clean-up-after-docker/)
12. [How to Use Docker on OS X: The Missing Guide](http://viget.com/extend/how-to-use-docker-on-os-x-the-missing-guide)
13. [introduction-to-docker](http://www.slideshare.net/winggundamth/introduction-to-docker-40139950)
14. [docker-workflow-fig-sh](http://www.syncano.com/docker-workflow-fig-sh/)
15. [Docker Exec Tutorial](https://www.youtube.com/watch?v=y-WH02MlIs8)
17. [Awesome-docker](http://veggiemonk.github.io/awesome-docker)
18. [Thai Docker Articles](http://thaiopensource.org/tag/docker/)
19. [Deep Docker Articles by Micheal Crosby](http://crosbymichael.com/category/docker.html)
20. [The Realities of Docker in Production](http://blog.heavybit.com/blog/2015/3/23/dockermeetup)
21. [Docker Toolbox - Migrate from Boot2Docker](http://docs.docker.com/installation/mac/#migrate-from-boot2docker)
22. [How to deploy PHP projects with docker](http://www.slideshare.net/ruoshiling/how-to-deploy-php-projects-with-docker)
23. [Docker: 4 useful tips, you may not know about](http://layer0.authentise.com/docker-4-useful-tips-you-may-not-know-about.html)
24. [Microcontainers – Tiny, Portable Docker Containers](http://www.iron.io/microcontainers-tiny-portable-containers/)
25. [Deep dive into Docker storage drivers](https://jpetazzo.github.io/assets/2015-03-03-not-so-deep-dive-into-docker-storage-drivers.html#1)
27. [Docker Cheat Sheet](https://github.com/wsargent/docker-cheat-sheet)
10. [Docker-in-Docker](https://github.com/jpetazzo/dind)
28. [Using Docker-in-Docker for your CI or testing environment? Think twice.](http://jpetazzo.github.io/2015/09/03/do-not-use-docker-in-docker-for-ci/)
29. [How to scale Docker Containers with Docker-Compose](https://www.brianchristner.io/how-to-scale-a-docker-container-with-docker-compose/)
32. [Anatomy of a Container: Namespaces, cgroups & Some Filesystem Magic - LinuxCon](http://www.slideshare.net/jpetazzo/anatomy-of-a-container-namespaces-cgroups-some-filesystem-magic-linuxcon)
